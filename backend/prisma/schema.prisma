generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  votes     Vote[]
  rooms     RoomMember[]
  messages  Message[]
  calendarEvents CalendarEvent[]
  voiceSettings  VoiceSettings?
  
  @@map("users")
}

model Restaurant {
  id          Int    @id @default(autoincrement())
  name        String @unique
  yelpId      String? @unique @map("yelp_id")
  address     String?
  phone       String?
  rating      Float?
  reviewCount Int?    @map("review_count")
  imageUrl    String? @map("image_url")
  latitude    Float?
  longitude   Float?
  cuisine     String?
  price       String?
  
  votes       Vote[]
  roomRestaurants RoomRestaurant[]
  
  @@map("restaurants")
}

model Room {
  id          String   @id @default(uuid())
  code        String   @unique @default(uuid())
  name        String
  cuisine     String?
  priceRange  String?  @map("price_range")
  latitude    Float?
  longitude   Float?
  radius      Int?     @default(5000)
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  
  members     RoomMember[]
  messages    Message[]
  roomRestaurants RoomRestaurant[]
  calendarEvents  CalendarEvent[]
  
  @@map("rooms")
}

model RoomMember {
  id     Int    @id @default(autoincrement())
  roomId String @map("room_id")
  userId Int?   @map("user_id")
  guestName String? @map("guest_name")
  isHost Boolean @default(false) @map("is_host")
  joinedAt DateTime @default(now()) @map("joined_at")
  
  room   Room   @relation(fields: [roomId], references: [id], onDelete: Cascade)
  user   User?  @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  @@unique([roomId, userId])
  @@unique([roomId, guestName])
  @@map("room_members")
}

model RoomRestaurant {
  id           Int        @id @default(autoincrement())
  roomId       String     @map("room_id")
  restaurantId Int        @map("restaurant_id")
  addedAt      DateTime   @default(now()) @map("added_at")
  addedBy      Int?       @map("added_by")
  
  room         Room       @relation(fields: [roomId], references: [id], onDelete: Cascade)
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  
  @@unique([roomId, restaurantId])
  @@map("room_restaurants")
}

model Vote {
  id           Int        @id @default(autoincrement())
  userId       Int        @map("user_id")
  restaurantId Int        @map("restaurant_id")
  roomId       String?    @map("room_id")
  voteCount    Int        @default(0) @map("vote_count")
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")
  
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
  
  @@unique([userId, restaurantId, roomId])
  @@map("votes")
}

model Message {
  id        Int      @id @default(autoincrement())
  roomId    String   @map("room_id")
  userId    Int?     @map("user_id")
  guestName String?  @map("guest_name")
  content   String
  createdAt DateTime @default(now()) @map("created_at")
  
  room      Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  user      User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  @@map("messages")
}

model CalendarEvent {
  id          String   @id @default(uuid())
  title       String
  description String?
  startTime   DateTime @map("start_time")
  endTime     DateTime @map("end_time")
  location    String?
  roomId      String?  @map("room_id")
  userId      Int      @map("user_id")
  status      String   @default("SCHEDULED")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  room        Room?    @relation(fields: [roomId], references: [id], onDelete: SetNull)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("calendar_events")
}

model VoiceSettings {
  id          Int      @id @default(autoincrement())
  userId      Int      @unique @map("user_id")
  enabled     Boolean  @default(true)
  language    String   @default("en-US")
  confidence  Float    @default(0.7)
  autoSubmit  Boolean  @default(false) @map("auto_submit")
  wakeWord    String?  @map("wake_word")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("voice_settings")
}
